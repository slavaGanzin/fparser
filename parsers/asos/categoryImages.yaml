placeholders:
  url: http://www.asos.com/women/tops/asos-basics/cat/?cid=17459&pgesize=204
  
steps:
  - get:
      url: $url
      
  - tap:
      pre:
        - find: .pager .next a
        - attr: href
      name: parsers/asos/categoryImages.yaml
      placeholders:
        url: $1
  
  - find: .product-container
  
  - parallel:
      category:
        - document
        - find: .creative .content h1
        - text
        - replace:
            - /(Wo)?men's/i
            - /asos\s+/i
            - /\n/g
            - /(^\s+|\s+$)/
  
      id:
        - attr: data-productid
  
      image:
        - find: .product-img
        - attr: src
        - get:
            limit: 1
  
  - db:
      provider: file
      id: $id
      key: data/asos/$category
      pre:
        - prop(image)
