placeholders:
  filter: $url

steps:
  - db:
      action: skip
      provider: memory
      key: /tmp
      id: $url
      pre:
        - input: true
      
  - get
  - parallel:
      id:
        - attr: url
        - url: path
        - replace:
          - $ /index
      host:
        - attr: url
        - url: hostname
      links:
        - find: a
        - attr: href
        - replace:
          - \#.*
          - \?.*
          - \/$
        - filter:
          - $filter
        - reject:
          - .xml
          - feed
        - uniq
        - tap:
            name: parsers/links.yaml
            placeholders:
              url: $1
              filter: $filter
      # html:
        # - html
      content:
        - html
        - readability
        - markdown
  - db:
      provider: file
      key: /tmp/$host
      id: $id
      pre:
        - attr: content
