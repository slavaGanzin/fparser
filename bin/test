#!/usr/bin/env node
require('../lib/global')
require('../lib/listeners')
cp = require('child_process')
fs = promisify('fs')
TEST_PATH = './tests'

runTests =
  map(test =>
    new Promise((resolve, reject) => {
      const file = ['bin/parse ', TEST_PATH, require('path').sep, test].join('')
      const start = new Date()
      return cp.exec(file, (error, result) =>
        error
          ? reject({file, error, result, start})
          : resolve({file, result, start})
    )})
    .then(result => console.log(result.file, '\t\t\t+', new Date() - result.start, 'ms'))
    .catch(error => {
      console.error(error)
      process.exit(1)
    })
)

fs.readdir(TEST_PATH).then(runTests)
