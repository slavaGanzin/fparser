#!/usr/bin/env node
require('../lib/global')
require('../lib/listeners')
const cp = require('child_process')
const fs = promisify('fs')
const path = require('path')
const TEST_PATH = './tests'
const ERROR = 1

const runTests = map(test =>
    new Promise((resolve, reject) => {
      const file = path.join('bin/parse .', TEST_PATH, test)
      const start = new Date()

      return cp.exec(file, (error, result) =>
        error
          ? reject({
            file,
            error,
            result,
            start
          })
          : resolve({
            file,
            result,
            start
          })
    )
    })
      .then(exec => console.log(exec.file, '\t\t\t', new Date() - exec.start, 'ms'))
      .catch(error => {
        debug('error')(error)
        process.exit(ERROR)
      })
)

fs.readdir(TEST_PATH).then(runTests)
